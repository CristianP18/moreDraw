{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Transform": "AWS::Serverless-2016-10-31",
    "Description": "tracebox",
    "Globals": {
        "Function": {
            "Runtime": "java11",
            "Timeout": 30,
            "MemorySize": 512
        }
    },
    "Parameters": {
        "Stage": {
            "Type": "String"
        },
        "Env": {
            "Type": "String"
        },
        "AwsId": {
            "Type": "String"
        },
        "Region": {
            "Type": "String"
        }
    },
    "Resources": {
        "RestApi": {
            "Type": "AWS::ApiGateway::RestApi",
            "Properties": {
                "Name": {
                    "Fn::Sub": "${Stage} - moreDraw - REST"
                },
                "FailOnWarnings": true,
                "Body": {
                    "Fn::Transform": {
                        "Name": "AWS::Include",
                        "Parameters": {
                            "Location": "s3://moredraw/deploy/api_rest.json"
                        }
                    }
                }
            },
            "Metadata": {
                "SamResourceId": "RestApi"
            }
        },
        "HttpApi": {
            "Type": "AWS::ApiGatewayV2::Api",
            "Properties": {
                "Body": {
                    "Fn::Transform": {
                        "Name": "AWS::Include",
                        "Parameters": {
                            "Location": "s3://moredraw/deploy/api_http.json"
                        }
                    }
                }
            },
            "Metadata": {
                "SamResourceId": "HttpApi"
            }
        },
        "postUserFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "MemorySize": 3008,
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-postUser"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/bdf6780071facbb2171b2d2b8cb505b4",
                "Handler": "handler.PostUsersHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "HttpApi",
                        "Properties": {
                            "Path": "/users",
                            "Method": "POST",
                            "ApiId": {
                                "Ref": "HttpApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:PutItem",
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:UpdateItem",
                                    "dynamodb:DeleteItem"
                                ],
                                "Resource": [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user/federalTax"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "postUserFunction"
            }
        },
        "postUsersLoginFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "MemorySize": 3000,
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-postUsersLogin"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/6f75062a6df3d0c3387a8711659c5915",
                "Handler": "handler.PostUsersLoginHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "HttpApi",
                        "Properties": {
                            "Path": "/users/login",
                            "Method": "POST",
                            "ApiId": {
                                "Ref": "HttpApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:PutItem",
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:UpdateItem",
                                    "dynamodb:DeleteItem"
                                ],
                                "Resource": [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user/index/federalTax"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "postUsersLoginFunction"
            }
        },
        "postUsersVerifyFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-postUsersVerify"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/4655d3fbb232f432b68e2a849655cd22",
                "Handler": "handler.PostUsersVerifyHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "HttpApi",
                        "Properties": {
                            "Path": "/users/verify",
                            "Method": "POST",
                            "ApiId": {
                                "Ref": "HttpApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:PutItem",
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:UpdateItem",
                                    "dynamodb:BatchWriteItem",
                                    "sns:Subscribe",
                                    "sns:Publish",
                                    "sns:CreateTopic",
                                    "sns:SetTopicAttributes"
                                ],
                                "Resource": [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user/index/federalTax"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "postUsersVerifyFunction"
            }
        },
        "putUsersVerifyFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-putUsersVerify"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/8159ade3a8b8d7f0b636ba9cb25f3f37",
                "Handler": "handler.PutUsersVerifyHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "HttpApi",
                        "Properties": {
                            "Path": "/users/verify",
                            "Method": "PUT",
                            "ApiId": {
                                "Ref": "HttpApi"
                            }
                        }
                    }
                },
                "Role": "arn:aws:iam::170387992571:role/sns-lambda-moreDraw"
            },
            "Metadata": {
                "SamResourceId": "putUsersVerifyFunction"
            }
        },
        "putUsersFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-putUsers"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/0de525d3976736b317bbb8a050d6a73a",
                "Handler": "handler.PutUsersHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "HttpApi",
                        "Properties": {
                            "Path": "/users/{userId}",
                            "Method": "PUT",
                            "ApiId": {
                                "Ref": "HttpApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:DeleteItem",
                                    "dynamodb:PutItem",
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:UpdateItem"
                                ],
                                "Resource": [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user/index/federalTax"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "putUsersFunction"
            }
        },
        "postUsersForgetPasswordFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-postUsersForgetPassword"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/8b1e6af6552541135d79f4b084ed30be",
                "Handler": "handler.PostUsersForgetPasswordHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "HttpApi",
                        "Properties": {
                            "Path": "/users/password/forget",
                            "Method": "POST",
                            "ApiId": {
                                "Ref": "HttpApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:PutItem",
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:UpdateItem",
                                    "sns:Publish",
                                    "sns:CreateTopic",
                                    "sns:SetTopicAttributes"
                                ],
                                "Resource": [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user/index/federalTax"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "postUsersForgetPasswordFunction"
            }
        },
        "postUsersVerifyPasswordFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-postUsersVerifyPassword"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/4d3e854414f15f554b770d154f664da5",
                "Handler": "handler.PostUsersVerifyPasswordHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "HttpApi",
                        "Properties": {
                            "Path": "/users/password/verify",
                            "Method": "POST",
                            "ApiId": {
                                "Ref": "HttpApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:PutItem",
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:UpdateItem"
                                ],
                                "Resource": [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user/index/federalTax"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "postUsersVerifyPasswordFunction"
            }
        },
        "deleteUsersFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-deleteUsers"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/a17aa5e74f092ded0d822dffbb15ad50",
                "Handler": "handler.DeleteUsersHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "HttpApi",
                        "Properties": {
                            "Path": "/users",
                            "Method": "DELETE",
                            "ApiId": {
                                "Ref": "HttpApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:PutItem",
                                    "dynamodb:UpdateItem",
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query"
                                ],
                                "Resource": [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user/index/federalTax"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "deleteUsersFunction"
            }
        },
        "getImageFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-getimage"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/1e0c964bd036e1b769bc2cce12e4a7aa",
                "Handler": "handler.GetImageHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "Api",
                        "Properties": {
                            "Path": "/image/{imageId}",
                            "Method": "GET",
                            "RestApiId": {
                                "Ref": "RestApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:PutItem",
                                    "dynamodb:UpdateItem"
                                ],
                                "Resource": [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image/index/createdBy-created"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "getImageFunction"
            }
        },
        "postImageFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-postimage"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/e8e2295461f65ea1f686218fde4ef6f6",
                "Handler": "handler.PostImageHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "Api",
                        "Properties": {
                            "Path": "/image",
                            "Method": "POST",
                            "RestApiId": {
                                "Ref": "RestApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:PutItem",
                                    "dynamodb:UpdateItem",
                                    "dynamodb:BatchWriteItem",
                                    "s3:GetObject",
                                    "s3:PutObject",
                                    "s3:DeleteObject"
                                ],
                                "Resource": [
                                    "arn:aws:s3:::moredraw",
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image/index/createdBy-created"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "postImageFunction"
            }
        },
        "putImagePictureFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-putimagePicture"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/eab6cd09ce718aa4e69b7b7a80068b84",
                "Handler": "handler.PutImagePictureHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "Api",
                        "Properties": {
                            "Path": "/image/picture/{imageId}",
                            "Method": "PUT",
                            "RestApiId": {
                                "Ref": "RestApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:PutItem",
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:UpdateItem",
                                    "s3:GetObject",
                                    "s3:PutObject",
                                    "s3:DeleteObject"
                                ],
                                "Resource": [
                                    "arn:aws:s3:::moredraw",
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image/index/createdBy-created"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "putImagePictureFunction"
            }
        },
        "putImageFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-putimage"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/30a9e34dae8dd91cf47b6a4fee445fb2",
                "Handler": "handler.PutImageHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "Api",
                        "Properties": {
                            "Path": "/image/{imageId}",
                            "Method": "PUT",
                            "RestApiId": {
                                "Ref": "RestApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:Query",
                                    "dynamodb:PutItem",
                                    "dynamodb:UpdateItem",
                                    "dynamodb:BatchWriteItem"
                                ],
                                "Resource": [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image/index/createdBy-created"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_user"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "putImageFunction"
            }
        },
        "deleteImageFunction": {
            "Type": "AWS::Serverless::Function",
            "Properties": {
                "Architectures": [
                    "x86_64"
                ],
                "SnapStart": {
                    "ApplyOn": "PublishedVersions"
                },
                "FunctionName": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "Stage"
                            },
                            "-deleteimage"
                        ]
                    ]
                },
                "Environment": {
                    "Variables": {
                        "ENV": {
                            "Ref": "Env"
                        }
                    }
                },
                "CodeUri": "s3://moredraw/deploy/525a2a046fe195ef48d84efa1c7bf8f6",
                "Handler": "handler.DeleteImageHandler::handleRequest",
                "Events": {
                    "List": {
                        "Type": "Api",
                        "Properties": {
                            "Path": "/image/{imageId}",
                            "Method": "Delete",
                            "RestApiId": {
                                "Ref": "RestApi"
                            }
                        }
                    }
                },
                "Policies": [
                    {
                        "Version": "2012-10-17",
                        "Statement": [
                            {
                                "Effect": "Allow",
                                "Action": [
                                    "dynamodb:GetItem",
                                    "dynamodb:Scan",
                                    "dynamodb:DeleteItem",
                                    "dynamodb:Query",
                                    "dynamodb:PutItem",
                                    "dynamodb:UpdateItem",
                                    "dynamodb:BatchWriteItem",
                                    "s3:GetObject",
                                    "s3:PutObject",
                                    "s3:DeleteObject"
                                ],
                                "Resource": [
                                    "arn:aws:s3:::moredraw",
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image/index/createdBy-created"
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:dynamodb:",
                                                {
                                                    "Ref": "Region"
                                                },
                                                ":",
                                                {
                                                    "Ref": "AwsId"
                                                },
                                                ":table/",
                                                {
                                                    "Ref": "Env"
                                                },
                                                "_image"
                                            ]
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Metadata": {
                "SamResourceId": "deleteImageFunction"
            }
        }
    }
}